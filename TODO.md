# TODO

## Performance
- [ ] [moving_average] Use typed memoryviews for `initialize()` loops and add `update_batch()` to process arrays in a single C loop. Est. 1.3x-2.5x for large windows/arrays. `src/mm_toolbox/moving_average/sma.pyx`, `src/mm_toolbox/moving_average/wma.pyx`, `src/mm_toolbox/moving_average/ema.pyx`, `src/mm_toolbox/moving_average/tema.pyx`
- [ ] [moving_average] Pass `disable_async=True` to `NumericRingBuffer` and skip allocating `_values` when `is_fast=True`. Est. 1.05x-1.2x per-update in tight loops. `src/mm_toolbox/moving_average/base.pyx`, `src/mm_toolbox/moving_average/sma.pyx`, `src/mm_toolbox/moving_average/wma.pyx`
- [ ] [websocket] Enable picows auto-ping/auto-pong to remove the per-connection ping thread; update latency tracking via `measure_roundtrip_time()` or `notify_user_specific_pong_received()`. Est. lower CPU and fewer threads at scale. `src/mm_toolbox/websocket/connection.pyx`, `.venv/lib/python3.13/site-packages/picows/picows.pyx`
- [ ] [websocket] For non-fragmented frames, copy directly from `WSFrame.payload_ptr` into `BytesRingBufferFast.insert_char()` to avoid `bytes` materialization in the hot path. Est. 1.1x-1.4x on high message rates. `src/mm_toolbox/websocket/connection.pyx`, `src/mm_toolbox/ringbuffer/bytes.pyx`, `.venv/lib/python3.13/site-packages/picows/picows.pxd`
- [ ] [logging/advanced] Replace per-log worker name bytes with a worker id + lookup table to cut payload and memcpy. Est. 1.05x-1.25x (larger when names are long and logs are small). `src/mm_toolbox/logging/advanced/worker.pyx`, `src/mm_toolbox/logging/advanced/master.pyx`
- [ ] [logging/advanced] Consider MPSC via per-producer SPSC SHM rings + fan-in consumer; define overflow policy (drop vs block). Est. 2x-4x for IPC portion; end-to-end ~1.3x-2.5x depending on serialization. `src/mm_toolbox/ringbuffer/shm/core.pyx`, `src/mm_toolbox/logging/advanced/worker.pyx`, `src/mm_toolbox/logging/advanced/master.pyx`
- [x] [orderbook/standard] Replace per-delta `insort`/`bisect_left` updates with batched apply + single resort (or an alternative structure) to avoid O(k*n) list shifting on bursty deltas. `src/mm_toolbox/orderbook/standard/orderbook.py`
- [x] [orderbook/standard] Skip recomputing ticks/lots when level precision info is already present and trusted in hot paths. `src/mm_toolbox/orderbook/standard/orderbook.py`, `src/mm_toolbox/orderbook/standard/level.py`
- [ ] [orderbook/advanced] Reuse scratch buffers in `consume_snapshot_numpy` and `consume_deltas_numpy` to avoid per-call malloc/free and per-element packing overhead. `src/mm_toolbox/orderbook/advanced/python.pyx`
- [ ] [orderbook/advanced] Add zero-copy view API for ladder reads (`get_bids`/`get_asks`) to avoid full-copy `memcpy` on each access. `src/mm_toolbox/orderbook/advanced/python.pyx`, `src/mm_toolbox/orderbook/advanced/level/level.pyx`
- [ ] [orderbook/advanced] Avoid unnecessary O(n log n) sorting when incoming levels are already monotonic or sortedness is known. `src/mm_toolbox/orderbook/advanced/core.pyx`
- [ ] [ringbuffer/numeric] Vectorize `insert_batch()` with one/two contiguous slice assignments instead of element-by-element Python loops. `src/mm_toolbox/ringbuffer/numeric.pyx`
- [ ] [ringbuffer/bytes] Replace O(n^2) `only_insert_unique` batch behavior with a bounded hash index plus eviction bookkeeping. `src/mm_toolbox/ringbuffer/bytes.pyx`
- [ ] [ringbuffer/numeric+generic] Replace modulo indexing with bitmask indexing in hot accessors where capacity is power-of-two. `src/mm_toolbox/ringbuffer/numeric.pyx`, `src/mm_toolbox/ringbuffer/generic.pyx`
- [ ] [ringbuffer/shm] Remove double-copy path in `consume`/`consume_all` (`bytearray` -> `bytes`) by allocating/filling target bytes once. `src/mm_toolbox/ringbuffer/shm/core.pyx`
- [ ] [ringbuffer/shm] Remove extra copy in `insert_packed()` by writing packed records directly into ring memory. `src/mm_toolbox/ringbuffer/shm/core.pyx`
- [ ] [rate_limiter] Remove duplicate refill/time checks in `try_consume` + `try_consume_multiple` hot paths. `src/mm_toolbox/rate_limiter/limiter.pyx`
- [ ] [websocket] Optimize fragmented-frame assembly with preallocated buffer + offset tracking and direct ring insertion to cut multi-copy overhead. `src/mm_toolbox/websocket/connection.pyx`
- [ ] [websocket] Reuse send buffer in `send_data_bytearray` to reduce per-message allocation churn. `src/mm_toolbox/websocket/connection.pyx`
- [ ] [websocket/pool] Replace O(n) duplicate-hash scan with bounded hash set + eviction queue for near O(1) checks. `src/mm_toolbox/websocket/pool.py`, `src/mm_toolbox/ringbuffer/numeric.pyx`
- [ ] [logging/standard] Make file handler non-blocking (or offloaded) to avoid stalling async flush on disk I/O. `src/mm_toolbox/logging/standard/handlers/file.py`, `src/mm_toolbox/logging/standard/logger.py`
- [ ] [logging/standard] Add bounded queue + overload policy (drop/sampling/backpressure) to prevent unbounded memory growth. `src/mm_toolbox/logging/standard/logger.py`
- [ ] [logging/standard] Replace sleep-based polling loop with blocking queue/condition-driven wakeups to reduce jitter and wasted wakeups. `src/mm_toolbox/logging/standard/logger.py`
- [ ] [logging/advanced] Decouple master dispatch from slow handlers (async/threaded fanout) so one handler cannot block all consumption. `src/mm_toolbox/logging/advanced/master.pyx`, `src/mm_toolbox/logging/advanced/handlers/file.py`
- [ ] [logging/advanced] Reuse file handles and avoid open/close/flush per push in file handler hot path. `src/mm_toolbox/logging/advanced/handlers/file.py`
- [ ] [candles] Replace `deepcopy` on candle close with targeted copy strategy for trades to reduce allocation pressure. `src/mm_toolbox/candles/base.pyx`
- [ ] [candles] Reduce repeated attribute math/lookups in volume/multi loops by tracking local totals and typed locals. `src/mm_toolbox/candles/volume.pyx`, `src/mm_toolbox/candles/multi.pyx`
- [ ] [rounding] Replace per-element Python callable dispatch with C-level branching/function pointers in round loops. `src/mm_toolbox/rounding/rounder.pyx`
- [ ] [weights] Vectorize `geometric_weights` generation with NumPy (`np.power`/`np.arange`) instead of Python list build. `src/mm_toolbox/weights/geometric.py`
- [ ] [time] Avoid temporary `bytes` allocation in `time_iso8601` decode path (decode directly from C string). `src/mm_toolbox/time/time.pyx`
